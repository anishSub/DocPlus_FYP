{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Profile - DocPlus</title>
    <link rel="stylesheet" href="{% static 'css/profile_view/edit_profile.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>

    <!-- Form starts here -->
    <form method="POST" action="" enctype="multipart/form-data">
        {% csrf_token %}
        
        <!-- Fixed Header -->
        <header class="edit-header">
            <div class="header-left">
                <a href="{% url 'profile' %}" class="close-btn"><i class="fas fa-times"></i></a>
                <div class="header-title">
                    <h2>Profile Settings</h2>
                    <p>Manage your account and preferences</p>
                </div>
            </div>
            <div class="header-right">
                <button type="submit" class="save-btn">
                    <i class="far fa-save"></i> Save Changes
                </button>
            </div>
        </header>

        <div class="main-container">
            
            <!-- Profile Photo -->
            <div class="photo-section">
                <div class="photo-wrapper">
                    <!-- Use user's image or a default avatar -->
                    {% if user.patientprofile.profile_image %}
                        <img src="{{ user.patientprofile.profile_image.url }}" alt="Profile" id="preview">
                    {% else %}
                        <img src="https://ui-avatars.com/api/?name={{ user.first_name }}+{{ user.last_name }}&background=0e5c98&color=fff&size=128" alt="Profile" id="preview">
                    {% endif %}
                    
                    <label for="id_image" class="camera-btn">
                        <i class="fas fa-camera"></i>
                        <input type="file" name="profile_image" id="id_image" accept="image/*" onchange="previewImage(this)">
                    </label>
                </div>
                <h3>{{ user.first_name }} {{ user.last_name }}</h3>
                <span class="patient-id">Patient ID: #PT-{{ user.id }}</span>
            </div>

            <!-- Form Content -->
            <div class="form-card">
                <div class="section-header">
                    <h3>Personal Information</h3>
                    <p>Update your personal details and profile information</p>
                </div>

                <!-- 1. Basic Info -->
                <h4 class="sub-title"><i class="far fa-user"></i> Basic Information</h4>
                <div class="form-grid">
                    <div class="form-group">
                        <label>First Name</label>
                        <input type="text" name="first_name" value="{{ user.first_name }}" required>
                    </div>
                    <div class="form-group">
                        <label>Last Name</label>
                        <input type="text" name="last_name" value="{{ user.last_name }}" required>
                    </div>
                    <div class="form-group">
                        <label>Email Address</label>
                        <input type="email" name="email" value="{{ user.email }}" readonly class="readonly-input">
                    </div>
                    <div class="form-group">
                        <label>Phone Number</label>
                        <input type="text" name="mobile_number" value="{{ user.patientprofile.mobile_number }}">
                    </div>
                    <div class="form-group">
                        <label>Date of Birth</label>
                        <input type="date" name="dob" value="{{ user.patientprofile.dob|date:'Y-m-d' }}">
                    </div>
                    <div class="form-group">
                        <label>Gender</label>
                        <select name="gender">
                            <option value="M" {% if user.patientprofile.gender == 'M' %}selected{% endif %}>Male</option>
                            <option value="F" {% if user.patientprofile.gender == 'F' %}selected{% endif %}>Female</option>
                            <option value="O" {% if user.patientprofile.gender == 'O' %}selected{% endif %}>Other</option>
                        </select>
                    </div>
                </div>

                <!-- 2. Address -->
                <h4 class="sub-title"><i class="fas fa-map-marker-alt"></i> Address Information</h4>
                <div class="form-grid">
                    <div class="form-group full-width">
                        <label>Full Address</label>
                        <input type="text" name="address" value="{{ user.patientprofile.address }}">
                    </div>
                    <div class="form-group">
                        <label>City</label>
                        <input type="text" name="city" value="{{ user.patientprofile.city }}">
                    </div>
                    <div class="form-group">
                        <label>Country</label>
                        <input type="text" name="country" value="Nepal" readonly>
                    </div>
                </div>

                <!-- 3. Medical Info -->
                <h4 class="sub-title"><i class="fas fa-heartbeat"></i> Medical Information</h4>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Blood Group</label>
                        <select name="blood_group">
                            <option value="A+" {% if user.patientprofile.blood_group == 'A+' %}selected{% endif %}>A+</option>
                            <option value="B+" {% if user.patientprofile.blood_group == 'B+' %}selected{% endif %}>B+</option>
                            <option value="O+" {% if user.patientprofile.blood_group == 'O+' %}selected{% endif %}>O+</option>
                            <!-- Add others -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Allergies</label>
                        <input type="text" name="allergies" value="{{ user.patientprofile.allergies }}">
                    </div>
                    <div class="form-group">
                        <label>Height (cm)</label>
                        <input type="number" name="height" value="{{ user.patientprofile.height }}">
                    </div>
                    <div class="form-group">
                        <label>Weight (kg)</label>
                        <input type="number" name="weight" value="{{ user.patientprofile.weight }}">
                    </div>
                    <div class="form-group full-width">
                        <label>Chronic Conditions</label>
                        <textarea name="chronic_conditions" rows="2">{{ user.patientprofile.chronic_conditions }}</textarea>
                    </div>
                    <div class="form-group full-width">
                        <label>Current Medications</label>
                        <textarea name="medications" rows="2">{{ user.patientprofile.medications }}</textarea>
                    </div>
                </div>

                <!-- 4. Emergency Contact -->
                <h4 class="sub-title"><i class="fas fa-user-shield"></i> Emergency Contact</h4>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Contact Name</label>
                        <input type="text" name="emergency_contact_name" value="{{ user.patientprofile.emergency_contact_name }}">
                    </div>
                    <div class="form-group">
                        <label>Relationship</label>
                        <input type="text" name="emergency_relationship" value="{{ user.patientprofile.emergency_relationship }}">
                    </div>
                    <div class="form-group">
                        <label>Phone Number</label>
                        <input type="text" name="emergency_phone" value="{{ user.patientprofile.emergency_phone }}">
                    </div>
                </div>

            </div>
        </div>
    </form>

    <script>
        function previewImage(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('preview').src = e.target.result;
                }
                reader.readAsDataURL(input.files[0]);
            }
        }
    </script>
</body>
</html>